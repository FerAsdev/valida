/**
 * Valida - jQuery plugin to validate forms in a as simple as possible way.  
 * Copyright (c) 2011-2013, Rogério Taques. 
 *
 * Licensed under MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this 
 * software and associated documentation files (the "Software"), to deal in the Software 
 * without restriction, including without limitation the rights to use, copy, modify, merge, 
 * publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons 
 * to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or 
 * substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING 
 * BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * @requires jQuery v1.9 or above
 * @version 2.1.1
 * @cat Plugins/Form Validation
 * @author Rogério Taques (rogerio.taques@gmail.com)
 * @see https://github.com/rogeriotaques/valida
 * 
 * Contributors:
 * - Kosuke Hiraga (hiraga@brijcs.co.jp)
 */


(function($){"use strict";var version='2.1.1',defaults={form_validate:'novalidate',form_autocomplete:'off',tag:'p',lost_focus:true,highlight:{marker:'*',position:'post'},messages:{submit:'Wait ...',required:'Required field',invalid:'Field with invalid data',textarea_help:'Typed <span class="at-counter">{0}</span> of {1}'},use_filter:true,before_validate:null,after_validate:null},filters={'email':/^[\w!#$%&'*+\/=?^`{|}~-]+(\.[\w!#$%&'*+\/=?^`{|}~-]+)*@(([\w-]+\.)+[A-Za-z]{2,6}|\[\d{1,3}(\.\d{1,3}){3}\])$/,'url':/^(http[s]?:\/\/|ftp:\/\/)?(www\.)?[a-zA-Z0-9-\.]+\.(com|org|net|mil|edu|ca|co.uk|com.au|gov|br|jp|co|in|me|la|ly)$/,'number':/^([0-9])+$/,'decimal':/^([0-9]{0,3}(\,|\.){0,1}){0,2}[0-9]{1,3}(\,[0-9]{2}|\.[0-9]{2}){0,1}$/,'date_br':/^([0-9]|[0,1,2][0-9]|3[0,1])\/(0[1-9]|1[0,1,2])\/\d{4}$/,'date':/^\d{4}-(0[0-9]|1[0,1,2])-([0,1,2][0-9]|3[0,1])$/,'time':/^([0-1][0-9]|[2][0-3])(:([0-5][0-9])){1,2}$/,'phone_br':/^\(?\d{2}\)?[\s-]?([9]){0,1}\d{4}-?\d{4}$/,'phone_jp':/^(((\(0\d{1}\)[\s-]?|0\d{1}-?)[2-9]\d{3}|(\(0\d{2}\)[\s-]?|0\d{2}-?)[2-9]\d{2,3}|(\(0\d{3}\)[\s-]?|0\d{3}-?)[2-9]\d{1}|(\(0\d{4}\)[\s-]?|0\d{4}-?)[2-9])-?\d{4}|(\(0\d{3}\)[\s-]?|0\d{3}-?)[2-9]\d{2}-?\d{3})$/,'zipcode_us':/^([A-Z][0-9]){3}$/,'zipcode_br':/^[0-9]{2}\.{0,1}[0-9]{3}\-[0-9]{3}$/,'zipcode_jp':/^[0-9]{3}\-?[0-9]{4}$/,'valid_ip':/^\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b$/,'min_length':function(s,l){return(s.length>=l);},'max_length':function(s,l){return(s.length<=l);},'matches':function(a,b){b=($('#'+b).val()||b);return(a==b);},'greater_than':function(v,r){if(!v.match(filters['number'])||!r.match(filters['number']))return false;return(parseInt(v,10)>parseInt(r,10));},'less_than':function(v,r){if(!v.match(filters['number'])||!r.match(filters['number']))return false;return(parseInt(v,10)<parseInt(r,10));}},o={},methods={version:function(){return this.each(function(){$(this).html(version);});},init:function(options){o=$.extend({},defaults,options);return this.each(function(){var f=$(this),err=false;f.data('old-autocomplete',f.attr('autocomplete'));f.data('old-novalidate',f.attr('novalidate'));f.attr('autocomplete',(o.autocomplete||o.form_autocomplete?(o.autocomplete||o.form_autocomplete):'off'));f.attr('novalidate',(o.novalidate||o.form_novalidate?(o.novalidate||o.form_novalidate):'novalidate'));f.find('button[type=reset], input[type=reset]').each(function(i,el){$(el).on('click.valida',function(e){_clear_all();$('input, select, textarea').filter(':first').focus();});});f.find('input, select, textarea').each(function(i,el){el=$(el);if(_ignore_this_element(el)){return;}if(el.is('[required]')&&o.highlight!==null&&o.highlight!==false){$('[for='+el.attr('id')+']').html((o.highlight.position=='pre'?'<span class="at-required-highlight" >'+o.highlight.marker+'</span>&nbsp;'+$('[for='+el.attr('id')+']').html():$('[for='+el.attr('id')+']').html()+'&nbsp;<span class="at-required-highlight" >'+o.highlight.marker+'</span>'));}if(o.lost_focus){el.on('blur.valida',function(e){if((el.is('select')&&el.is('[required]')&&(el.find('option').filter(':selected').val()===''||!el.find('option').length))||(el.is('textarea')&&el.is('[required]')&&el.val()==='')||(el.is('input')&&el.prop('type')==='checkbox'&&el.is('[required]')&&!el.is(':checked'))||(el.is('input')&&el.prop('type')!=='checkbox'&&el.is('[required]')&&el.val()==='')){_show_error(el,el.is('[type=checkbox]'));}});}if(el.is('textarea')&&el.attr('maxlength')){el.after($('<div />',{'class':'help-block at-description','html':(el.data('help')||(o.messages.textarea_help?o.messages.textarea_help:'Typed <span class="at-counter">{0}</span> of {1}')).replace('{1}',el.attr('maxlength')).replace('{0}',el.val().length)}));el.on('keyup.valida',function(e){_char_count(e,el,el.attr('maxlength'));}).on('keydown.valida',function(e){_char_count(e,el,el.attr('maxlength'));});}el.on('change.valida',function(e){if(el.val()!==''&&el.is('select')){_clear(el);}});if(el.is('input')&&el.prop('type')==='checkbox'&&el.is('[required]')){el.on('click.valida',function(e){_clear(el);if(!el.is(':checked')){_show_error(el,el.is('[type=checkbox]'));}});}else
{el.on('keyup.valida',function(e){if(el.val()!==''){_typing_handler(el);}}).on('keydown.valida',function(e){_typing_handler(el);});}});f.on('submit.valida',function(e){var err=false;_clear_all();if(o.before_validate&&$.isFunction(o.before_validate)){err=!o.before_validate(e);}f.find('button[type=submit], input[type=submit]').each(function(i,el){el=$(el);el.prop('disabled',true).data('old-value',(el.is('input')?el.val():el.html()));if(el.is('input')){el.val(o.messages.submit||'Wait ...');}else
{el.html(o.messages.submit||'Wait ...');}});f.find('input, select, textarea').each(function(i,el){el=$(el);err=!_partial_validation(el,true,false,err);});if(o.after_validate&&$.isFunction(o.after_validate)){err=!o.after_validate(e,err);}if(err){e.preventDefault();f.find('button[type=submit], input[type=submit]').each(function(i,el){el=$(el);el.prop('disabled',false);if(el.is('input')){el.val(el.data('old-value'));}else
{el.html(el.data('old-value'));}});var wmid=Math.ceil($(window).height()/2);$('html,body').animate({'scrollTop':$('.at-required:visible, .at-invalid:visible').filter(':first').offset().top-wmid},'fast',function(ev){$('.at-required:visible, .at-invalid:visible').filter(':first').focus();});return false;}});});},destroy:function(){var f=$(this);f.attr('autocomplete',f.data('old-autocomplete'));f.attr('novalidate',f.data('old-novalidate'));f.find('button, input[type=reset]').off('valida');f.find('button, input[type=reset]').unbind('.valida');f.find('input, select, textarea').off('valida');f.find('input, select, textarea').unbind('.valida');f.find('.help-block.at-description').remove();f.off('valida');f.unbind('.valida');f.valida=null;},partial:function(el,show_error,force_clear){var err=_partial_validation(el,show_error,force_clear);if(err){var wmid=Math.ceil($(window).height()/2);$('html,body').animate({'scrollTop':$('.at-required:visible, .at-invalid:visible').filter(':first').offset().top-wmid},'fast',function(ev){$('.at-required:visible, .at-invalid:visible').filter(':first').focus();});}return err;}};function _partial_validation(el,show_error,force_clear,prev_state){var err=(prev_state===undefined?false:prev_state);show_error=(show_error===undefined?true:show_error);force_clear=(force_clear===undefined?true:force_clear);el=(typeof el=='object'?el:$(el));if(force_clear){_clear(el);}if(!el.length||_ignore_this_element(el)){return false;}if(el.is('[required]')&&((!el.is('[type=checkbox]')&&el.val()=='')||(el.is('[type=checkbox]')&&!el.is(':checked'))||(el.is('select')&&!el.find('option:selected').length))){err=true;if(show_error){_show_error(el,el.is('[type=checkbox]'));}}else if(o.use_filter&&el.attr('filter')&&!_is_filter_valid(el)){err=true;if(show_error){_show_warning(el,el.is('[type=checkbox]'));}}return!err;}function _typing_handler(el){var is_filter_valid=!_is_filter_valid(el,o);if(o.use_filter&&el.attr('filter')&&is_filter_valid){_show_warning(el,el.is('[type=checkbox]'));}else if(el.val()!==''&&el.attr('filter')&&!is_filter_valid){_show_success(el,el.is('[type=checkbox]'));}else
{_clear(el);}}function _char_count(e,el,max){if(el.val().length>max){e.preventDefault();return;}el.siblings('.at-description').find('span.at-counter').html(el.val().length);};function _is_filter_valid(el){var list=el.attr('filter')!==undefined&&el.attr('filter').indexOf('|')!==-1?el.attr('filter').split('|'):[el.attr('filter')],pattern=/^(\w\d)+/,error=false;for(var i=0;i<list.length;i++){pattern=list[i];if(pattern!==undefined&&pattern.indexOf(':')!==-1){pattern=list[i].split(':');error=(el.val()!==''&&!(filters[pattern[0]]&&filters[pattern[0]](el.val(),(el.parents('form').find('#'+pattern[1]).val()||pattern[1]))));if(error)break;}else
{pattern=(filters[el.attr('filter')]||pattern);error=(el.val()!==''&&!el.val().match(pattern));if(error)break;}}return!error;}function _show_success(el,is_checkbox){_clear(el);el.addClass('at-success');el.closest('.form-group').addClass('has-success').addClass('has-feedback');if(!is_checkbox&&el.is(':visible')){el.after($('<span />',{'class':'glyphicon glyphicon-ok form-control-feedback'}));}}function _show_warning(el,is_checkbox){var msg=(el.data('invalid')||(o.messages.invalid?o.messages.invalid:'This field has invalid data')),place=(el.data('place-after')||el);_clear(el);el.addClass('at-invalid');el.closest('.form-group').addClass('has-warning').addClass('has-feedback');if(!is_checkbox){$(place).after($('<'+(o.tag?o.tag:'p')+'/>',{'class':'at-warning','html':msg}));if(el.is(':visible')){$(place).after($('<span />',{'class':'glyphicon glyphicon-warning-sign form-control-feedback'}));}}else
{el.parent('label').after($('<span />',{'class':'at-warning','html':msg}));}}function _show_error(el,is_checkbox){var msg=(el.data('required')||(o.messages.required?o.messages.required:'This field is required')),place=(el.data('place-after')||el),place_for_msg=(el.data('place-after')||(el.closest('.form-group').hasClass('input-group')?el.closest('.form-group'):el));_clear(el);el.addClass('at-required');el.closest('.form-group').addClass('has-error').addClass('has-feedback');if(!is_checkbox){$(place_for_msg).after($('<'+(o.tag?o.tag:'p')+'/>',{'class':'at-error','html':msg}));if(el.is(':visible')){$(place).after($('<span />',{'class':'glyphicon glyphicon-remove form-control-feedback'}));}}else
{el.parent().find('.at-error,.at-warning,.at-info,.at-success').remove();el.next('label').after($('<span />',{'class':'at-error','html':'&nbsp;'+msg}));}}function _clear(el){el.removeClass('at-required at-invalid at-success');if(!el.is('[type=checkbox]')){if(el.closest('.form-group').hasClass('input-group')){el.closest('.form-group').siblings('.form-control-feedback, .at-error, .at-warning, .at-info').remove();}el.closest('.form-group').removeClass('has-error has-warning has-success has-feedback');el.siblings('.form-control-feedback, .at-error, .at-warning, .at-info, .at-success').remove();}else
{el.siblings('.form-control-feedback, .at-error, .at-warning, .at-info, .at-success').remove();}};function _clear_all(){$('.at-error, .at-warning, .at-info, .form-control-feedback').remove();$('.at-required, .at-invalid, .at-success, .has-error, .has-warning, .has-feedback, .has-success').removeClass('at-required at-invalid at-success has-error has-warning has-feedback has-success');};function _ignore_this_element(el){var types_of_elements_to_ignore=['submit','reset','button','image'];return!el.is('input')||(el.is('input')&&$.inArray(el.prop('type'),types_of_elements_to_ignore))===-1?false:true;}$.fn.valida=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.valida()');}};})(jQuery);